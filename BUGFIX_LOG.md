# Bug Fix Log

## Bug #001: Поле ввода деактивируется после ввода второго символа

**Статус:** ✅ ИСПРАВЛЕН  
**Дата исправления:** 12 сентября 2025  
**Коммит:** `572a32b`

### Описание проблемы

**Компонент:** Калькулятор расчета себестоимости (Блок 1: Себестоимость (COGS))

**Шаги для воспроизведения:**
1. Открыть страницу с калькулятором
2. В "Блоке 1: Себестоимость (COGS)" кликнуть на любое поле ввода (например, "Закупочная цена")
3. Попробовать ввести число, состоящее из двух и более цифр (например, "10" или "123")

**Фактический результат:**
После ввода первой цифры поле остается активным. Сразу после ввода второй цифры поле теряет фокус и становится неактивным, дальнейший ввод невозможен.

**Ожидаемый результат:**
Пользователь может вводить в поле многозначные числа без каких-либо препятствий. Поле ввода должно оставаться активным до тех пор, пока пользователь сам не переведет фокус на другой элемент.

### Техническая причина

Проблема была в компоненте `src/components/ui/Input.tsx`:

1. **Неправильная логика в `handleChange`:**
   ```javascript
   const numValue = parseFloat(rawValue) || 0; // ❌ Проблема
   onChange(numValue); // Вызывался даже для неполных значений
   ```

2. **Конфликт `useEffect` с активным вводом:**
   ```javascript
   useEffect(() => {
     if (!isFocused) {
       setDisplayValue(value.toString()); // ❌ Перезаписывал значение
     }
   }, [value, isFocused]);
   ```

### Исправление

**Файлы изменены:**
- `src/components/ui/Input.tsx`

**Ключевые изменения:**

1. **Улучшена логика `handleChange`:**
   ```javascript
   // ✅ Проверка на неполные значения
   if (rawValue === '' || rawValue === '-' || rawValue === '.') {
     return; // Не отправляем изменения
   }
   
   const numValue = parseFloat(rawValue);
   if (!isNaN(numValue)) {
     onChange(numValue); // Только для валидных чисел
   }
   ```

2. **Исправлен `handleBlur`:**
   ```javascript
   // ✅ Корректная обработка финального значения
   if (displayValue === '' || displayValue === '-' || displayValue === '.') {
     onChange(0);
     setDisplayValue('0');
   }
   ```

3. **Оптимизирован `useEffect`:**
   ```javascript
   // ✅ Избегаем конфликтов с активным вводом
   if (!isFocused && value.toString() !== displayValue) {
     setDisplayValue(value.toString());
   }
   ```

### Затронутые компоненты

- ✅ Блок 1: Себестоимость (COGS) - все поля
- ✅ Блок 2: Расходы маркетплейса - все поля  
- ✅ Все остальные формы с Input компонентами

### Тестирование

- ✅ Проверено на полях "Закупочная цена", "Доставка до склада"
- ✅ Проверено на полях "Упаковка и маркировка", "Прочие расходы COGS"
- ✅ Проверена работа с числами: 10, 123, 1000, 12345
- ✅ Проверена работа с десятичными числами: 15.5, 100.25
- ✅ Проверена работа процентных полей (type="percentage")
- ✅ Проверена работа валютных полей (type="currency")

### Влияние на пользователей

**До исправления:**
- ❌ Невозможно ввести числа > 9
- ❌ Расчеты недоступны для большинства товаров
- ❌ Критическая блокировка функциональности

**После исправления:**
- ✅ Можно вводить любые многозначные числа
- ✅ Все расчеты работают корректно
- ✅ Улучшен пользовательский опыт
